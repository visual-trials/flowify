<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Simple template</title>
  </head>
  <body>
    
  </body>
  <script>
    let ctx = canvas.getContext("2d");

    function setStackPtr(memory: (Uint8Array|ArrayBuffer), ptr: number): void {
        var buffer : ArrayBuffer = (<any>memory).buffer || memory;
        new Int32Array(buffer)[1] = ptr;
    }
    
    var wasmCode = new Uint8Array([0,97,115,109,1,0,0,0,1,38,7,96,0,1,127,96,4,127,127,127,127,1,127,96,1,127,1,127,96,0,0,96,3,125,125,125,1,127,96,2,127,127,1,127,96,1,127,0,2,54,3,3,101,110,118,11,106,115,67,108,101,97,114,82,101,99,116,0,1,3,101,110,118,10,106,115,70,105,108,108,82,101,99,116,0,1,3,101,110,118,11,115,101,116,73,110,116,101,114,118,97,108,0,2,3,9,8,2,0,4,5,6,0,0,3,4,5,1,112,1,2,2,5,3,1,0,1,7,86,8,6,109,101,109,111,114,121,2,0,11,114,117,110,67,97,108,108,98,97,99,107,0,3,9,100,114,97,119,87,111,114,108,100,0,4,12,118,97,108,117,101,73,110,82,97,110,103,101,0,5,11,114,101,99,116,79,118,101,114,108,97,112,0,6,4,109,111,118,101,0,7,4,116,105,99,107,0,8,4,109,97,105,110,0,9,9,8,1,0,65,0,11,2,10,8,10,249,7,8,7,0,32,0,17,0,0,11,207,1,1,1,127,65,0,42,2,20,168,65,0,42,2,24,168,65,0,42,2,28,168,65,0,42,2,32,168,16,1,26,65,0,42,2,48,168,65,0,42,2,52,168,65,0,42,2,56,168,65,0,42,2,60,168,16,1,26,65,0,42,2,76,168,65,0,42,2,80,168,65,0,42,2,84,168,65,0,42,2,88,168,16,1,26,65,0,42,2,104,168,65,0,42,2,108,168,65,0,42,2,112,168,65,0,42,2,116,168,16,1,26,65,0,42,2,132,1,168,65,0,42,2,136,1,168,65,0,42,2,140,1,168,65,0,42,2,144,1,168,16,1,26,65,0,42,2,160,1,168,65,0,42,2,164,1,168,65,0,42,2,168,1,168,65,0,42,2,172,1,168,16,1,26,65,0,42,2,188,1,168,65,0,42,2,192,1,168,65,0,42,2,196,1,168,65,0,42,2,200,1,168,16,1,26,32,0,11,13,0,32,0,32,1,96,32,0,32,2,95,113,11,149,1,2,1,127,2,125,2,64,2,64,32,0,42,2,0,34,3,32,1,42,2,0,34,4,93,32,3,32,3,92,32,4,32,4,92,114,114,13,0,65,1,33,2,32,3,32,4,32,1,42,2,8,146,95,13,1,11,32,4,32,3,96,32,4,32,3,32,0,42,2,8,146,95,113,33,2,11,2,64,32,0,42,2,4,34,3,32,1,42,2,4,34,4,93,32,3,32,3,92,32,4,32,4,92,114,114,13,0,32,3,32,4,32,1,42,2,12,146,95,69,13,0,32,2,65,1,113,15,11,32,2,32,4,32,3,96,32,4,32,3,32,0,42,2,12,146,95,113,113,11,206,4,2,9,127,14,125,32,0,65,8,106,42,2,0,34,11,32,0,65,16,106,42,2,0,34,13,146,33,15,32,11,32,0,65,24,106,34,3,42,2,0,34,20,146,33,23,32,0,65,16,107,33,2,32,0,42,2,4,34,10,32,0,42,2,20,34,21,146,33,22,32,10,32,0,65,12,106,42,2,0,34,12,146,33,14,32,0,40,2,0,33,1,65,0,33,7,32,0,65,20,106,33,6,3,64,2,64,32,2,32,7,70,13,0,32,7,65,16,106,40,2,0,32,1,70,13,0,32,7,65,32,106,42,2,0,33,19,32,7,65,24,106,42,2,0,33,17,32,7,65,20,106,42,2,0,34,16,32,7,65,28,106,42,2,0,146,33,18,2,64,2,64,32,22,32,16,93,32,22,32,22,92,32,16,32,16,92,34,4,114,114,13,0,65,1,33,8,32,22,32,18,95,13,1,11,32,16,32,22,96,32,16,32,22,32,12,146,95,113,33,8,11,32,17,32,19,146,33,19,2,64,2,64,32,23,32,17,93,32,23,32,23,92,32,17,32,17,92,34,5,114,114,13,0,65,1,33,9,32,23,32,19,95,13,1,11,32,17,32,23,96,32,17,32,23,32,13,146,95,113,33,9,11,32,8,32,9,113,65,1,71,13,0,2,64,2,64,32,10,32,21,146,34,23,32,16,93,32,23,32,23,92,32,4,114,114,13,0,65,1,33,8,32,23,32,18,95,13,1,11,32,16,32,23,96,32,16,32,23,32,12,146,95,113,33,8,11,2,64,2,64,32,11,32,17,93,32,11,32,11,92,32,5,114,114,13,0,65,1,33,9,32,11,32,19,95,13,1,11,32,17,32,11,96,32,17,32,15,95,113,33,9,11,2,64,32,8,32,9,113,65,1,71,13,0,32,6,32,21,140,34,21,56,2,0,11,32,11,32,20,146,33,23,2,64,2,64,32,10,32,16,93,32,10,32,10,92,32,4,114,114,13,0,65,1,33,8,32,10,32,18,95,13,1,11,32,16,32,10,96,32,16,32,14,95,113,33,8,11,2,64,2,64,32,23,32,17,93,32,23,32,23,92,32,5,114,114,13,0,65,1,33,9,32,23,32,19,95,13,1,11,32,17,32,23,96,32,17,32,13,32,23,146,95,113,33,9,11,2,64,32,8,32,9,113,65,1,71,13,0,32,3,32,20,140,34,20,56,2,0,11,32,23,32,20,146,33,23,32,10,32,21,146,33,22,11,32,7,65,28,106,34,7,65,196,1,71,13,0,11,32,0,65,8,106,32,23,56,2,0,32,0,65,4,106,32,22,56,2,0,11,27,1,1,127,65,0,65,0,65,128,8,65,128,8,16,0,26,16,4,26,65,184,1,16,7,32,0,11,9,0,65,1,16,2,26,65,42,11,3,0,0,11,11,203,1,1,0,65,16,11,196,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,68,0,0,0,66,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,120,68,0,0,128,68,0,0,0,66,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,194,0,0,0,0,0,0,0,66,0,0,128,68,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,68,0,0,0,0,0,0,0,66,0,0,128,68,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,65,0,0,224,67,0,0,0,66,0,0,0,67,0,0,0,0,0,0,0,0,0,0,0,0,0,0,116,68,0,0,224,67,0,0,0,66,0,0,0,67,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,68,0,0,0,68,0,0,0,66,0,0,0,66,102,102,102,63,51,51,51,63]);
    
    var env = {
      setInterval: function (x) {
        setInterval(() => {
          wasmInstance.exports.runCallback(x);  
        }, 16);
      },
      jsFillRect: function (x, y, w, h) {
        ctx.fillStyle = "orange";
        ctx.fillRect(x, y, w, h);
      },
      jsClearRect: function (x, y, w, h) {
        ctx.clearRect(x, y, w, h);
      }
    }
    var wasmModule = new WebAssembly.Module(wasmCode);
    var wasmInstance = new WebAssembly.Instance(wasmModule, {
      env: env
    });
    var m = new Uint8Array(wasmInstance.exports.memory.buffer);

    setStackPtr(wasmInstance.exports.memory, 0x2000);

    wasmInstance.exports.main();

    // lib.showCanvas(true);
  
  /*
      var importObject = {
          imports: { imported_func: arg => console.log(arg) }
      };
    

      var request = new XMLHttpRequest();
      request.open('GET', 'simple.wasm');
      request.responseType = 'arraybuffer';
      request.send();

      request.onload = function() {
          var bytes = request.response;
          WebAssembly.instantiate(bytes, importObject).then(results => {
              results.instance.exports.exported_func();
          });
      };
*/
  </script>
</html>
